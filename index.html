<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Focus</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<style>
:root {
  --bg: #000;
  --panel: #0a0a0a;
  --card: #111;
  --divider: #1c1c1e;
  --text: #f2f2f7;
  --muted: #8e8e93;
  --accent: #7c7cff;
  --accent2: #5eead4;
  --danger: #ff453a;
  --radius: 16px;
}

* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro", system-ui, sans-serif;
}

#app {
  max-width: 480px;
  margin: 0 auto;
  padding: env(safe-area-inset-top) 16px 96px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
}

h1 {
  font-size: 28px;
  margin: 0;
}

button {
  background: none;
  border: none;
  color: var(--accent);
  font-size: 22px;
}

.card {
  background: var(--card);
  border-radius: var(--radius);
  margin-bottom: 16px;
  overflow: hidden;
}

.section {
  padding: 12px 14px;
  font-size: 13px;
  color: var(--muted);
}

.list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px;
  border-top: 1px solid var(--divider);
  transition: transform .3s ease, opacity .3s ease;
}

.item.done {
  opacity: 0;
  transform: translateX(80px);
}

.left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.check {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  border: 2px solid var(--muted);
}

.check.done {
  background: var(--accent);
  border-color: var(--accent);
}

.small {
  font-size: 12px;
  color: var(--muted);
}

.tabbar {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: var(--panel);
  border-top: 1px solid var(--divider);
  display: flex;
  justify-content: space-around;
  padding: 10px 0 env(safe-area-inset-bottom);
}
</style>
</head>

<body>
<div id="app">
  <header>
    <h1 id="title">Inbox</h1>
    <button onclick="addTask()">ï¼‹</button>
  </header>

  <div class="card">
    <div class="section">Tasks</div>
    <ul class="list" id="tasks"></ul>
  </div>
</div>

<div class="tabbar">
  <button onclick="setView('inbox')">Inbox</button>
  <button onclick="setView('today')">Today</button>
  <button onclick="setView('calendar')">Calendar</button>
  <button onclick="setView('habits')">Habits</button>
</div>

<script>
let view = "inbox";
let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
let habits = JSON.parse(localStorage.getItem("habits") || "[]");

const today = new Date().toISOString().slice(0,10);

function save() {
  localStorage.setItem("tasks", JSON.stringify(tasks));
  localStorage.setItem("habits", JSON.stringify(habits));
  render();
}

function setView(v) {
  view = v;
  document.getElementById("title").textContent =
    v.charAt(0).toUpperCase() + v.slice(1);
  render();
}

function addTask() {
  const title = prompt("Task");
  if (!title) return;

  const due = prompt("Due date (YYYY-MM-DD)");
  const cal = confirm("Add to Apple Calendar?");

  const t = { id: Date.now(), title, due, cal };
  tasks.push(t);
  if (cal && due) exportICS(t);
  save();
}

function completeTask(id, el) {
  el.classList.add("done");
  setTimeout(() => {
    tasks = tasks.filter(t => t.id !== id);
    save();
  }, 300);
}

function exportICS(task) {
  const d = task.due.replace(/-/g,"");
  const ics = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${task.title}
DTSTART:${d}
DTEND:${d}
END:VEVENT
END:VCALENDAR`;
  const blob = new Blob([ics], { type: "text/calendar" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = task.title + ".ics";
  a.click();
}

function render() {
  const ul = document.getElementById("tasks");
  ul.innerHTML = "";

  let filtered = tasks;
  if (view === "today")
    filtered = tasks.filter(t => t.due === today);

  filtered.forEach(t => {
    const li = document.createElement("li");
    li.className = "item";
    li.innerHTML = `
      <div class="left">
        <div class="check"></div>
        <div>
          <div>${t.title}</div>
          ${t.due ? `<div class="small">${t.due}</div>` : ""}
        </div>
      </div>
    `;
    li.onclick = () => completeTask(t.id, li);
    ul.appendChild(li);
  });
}

render();
</script>
</body>
</html>
